module TestFP

include(joinpath(@__DIR__, "..", "..", "src", "ZMPBipedRobot.jl"))
import .ZMPBipedRobot
const ZMProbot = ZMPBipedRobot
using Test

sleep(0.1) # used for good printing
println("Started test")

URDFfileName = "ZMP_2DBipedRobot.urdf"
br = ZMProbot.BipedRobot(;
    readFile = true,
    URDFfileName = URDFfileName,
    paramFileName = "param_test.jl",
)

@testset "Foot Planner Diagonal Straight Path" begin
    t = vec(0:100)
    br.yPath = 1.18 .+ 0.0 .* t
    br.xPath = 0.01 * t
    br.initial_position = [br.xPath[1]; br.yPath[1]; 0.0]
    fp = ZMProbot.FootPlanner(; br = br)

    @test fp.center[end][1:2] ≈ [br.xPath[end]; br.yPath[end]] atol = 0.01
    @test length(fp.center) > 0

    @test fp.center == Array{Float64}[
        [0.0, 1.18, 0.0],
        [0.1, 1.18, 0.0],
        [0.2, 1.18, 0.0],
        [0.31, 1.18, 0.0],
        [0.42, 1.18, 0.0],
        [0.52, 1.18, 0.0],
        [0.63, 1.18, 0.0],
        [0.74, 1.18, 0.0],
        [0.85, 1.18, 0.0],
        [0.96, 1.18, 0.0],
        [1.0, 1.18, 0.0],
    ]
    @test fp.right == Array{Float64}[
        [0.0, 1.154, 0.0],
        [0.1, 1.154, 0.0],
        [0.1, 1.154, 0.0],
        [0.31, 1.154, 0.0],
        [0.31, 1.154, 0.0],
        [0.52, 1.154, 0.0],
        [0.52, 1.154, 0.0],
        [0.74, 1.154, 0.0],
        [0.74, 1.154, 0.0],
        [0.96, 1.154, 0.0],
        [0.96, 1.154, 0.0],
    ]
    @test fp.left == Array{Float64}[
        [0.0, 1.206, 0.0],
        [0.0, 1.206, 0.0],
        [0.2, 1.206, 0.0],
        [0.2, 1.206, 0.0],
        [0.42, 1.206, 0.0],
        [0.42, 1.206, 0.0],
        [0.63, 1.206, 0.0],
        [0.63, 1.206, 0.0],
        [0.85, 1.206, 0.0],
        [0.85, 1.206, 0.0],
        [1.0, 1.206, 0.0],
    ]
end

@testset "Foot Planner Diagonal Straight Path" begin
    t = vec(0:100)
    br.xPath = 0.01 * t
    br.yPath = 1.18 .+ 0.01 * t
    br.initial_position = [br.xPath[1], br.yPath[1], pi / 4]
    fp = ZMProbot.FootPlanner(; br = br, check = false)

    @test fp.center[end][1:2] ≈ [br.xPath[end]; br.yPath[end]] atol = 0.01
    @test length(fp.center) > 0

    @test fp.center == Array{Float64}[
        [0.0, 1.18, 0.7853981633974483],
        [0.08, 1.26, 0.785398163397449],
        [0.16, 1.3399999999999999, 0.7853981633974483],
        [0.24, 1.42, 0.7853981633974497],
        [0.32, 1.5, 0.7853981633974483],
        [0.4, 1.5799999999999998, 0.7853981633974483],
        [0.48, 1.66, 0.7853981633974483],
        [0.56, 1.74, 0.7853981633974483],
        [0.64, 1.8199999999999998, 0.7853981633974483],
        [0.72, 1.9, 0.7853981633974483],
        [0.8, 1.98, 0.7853981633974483],
        [0.88, 2.06, 0.7853981633974594],
        [0.96, 2.14, 0.7853981633974594],
        [1.0, 2.1799999999999997, 0.7853981633974372],
    ]
    @test fp.right == Array{Float64}[
        [0.018384776310850233, 1.1616152236891497, 0.7853981633974483],
        [0.09838477631085024, 1.2416152236891498, 0.785398163397449],
        [0.09838477631085024, 1.2416152236891498, 0.785398163397449],
        [0.2583847763108503, 1.4016152236891497, 0.7853981633974497],
        [0.2583847763108503, 1.4016152236891497, 0.7853981633974497],
        [0.41838477631085025, 1.5616152236891496, 0.7853981633974483],
        [0.41838477631085025, 1.5616152236891496, 0.7853981633974483],
        [0.5783847763108503, 1.7216152236891498, 0.7853981633974483],
        [0.5783847763108503, 1.7216152236891498, 0.7853981633974483],
        [0.7383847763108502, 1.8816152236891497, 0.7853981633974483],
        [0.7383847763108502, 1.8816152236891497, 0.7853981633974483],
        [0.8983847763108505, 2.04161522368915, 0.7853981633974594],
        [0.8983847763108505, 2.04161522368915, 0.7853981633974594],
        [1.01838477631085, 2.1616152236891493, 0.7853981633974372],
    ]
    @test fp.left == Array{Float64}[
        [-0.018384776310850233, 1.1983847763108502, 0.7853981633974483],
        [-0.018384776310850233, 1.1983847763108502, 0.7853981633974483],
        [0.14161522368914978, 1.35838477631085, 0.7853981633974483],
        [0.14161522368914978, 1.35838477631085, 0.7853981633974483],
        [0.3016152236891498, 1.5183847763108502, 0.7853981633974483],
        [0.3016152236891498, 1.5183847763108502, 0.7853981633974483],
        [0.46161522368914976, 1.6783847763108501, 0.7853981633974483],
        [0.46161522368914976, 1.6783847763108501, 0.7853981633974483],
        [0.6216152236891498, 1.83838477631085, 0.7853981633974483],
        [0.6216152236891498, 1.83838477631085, 0.7853981633974483],
        [0.7816152236891498, 1.9983847763108502, 0.7853981633974483],
        [0.7816152236891498, 1.9983847763108502, 0.7853981633974483],
        [0.9416152236891495, 2.15838477631085, 0.7853981633974594],
        [0.9416152236891495, 2.15838477631085, 0.7853981633974594],
    ]
end

@testset "Foot Planner Circular Path" begin
    t = vec(100:-1:75)
    br.xPath = -0 .- 1.18 * sin.(2 * pi / 100 .* t)
    br.yPath = 0 .+ 1.18 * cos.(2 * pi / 100 .* t)
    br.initial_position = [br.xPath[1], br.yPath[1], 0]
    fp = ZMProbot.FootPlanner(; br = br)

    @test fp.center[end][1:2] ≈ [br.xPath[end]; br.yPath[end]] atol = 0.01
    @test length(fp.center) > 0

    @test fp.center == Array{Float64}[
        [-7.590338906473724e-16, 1.18, 0.0],
        [0.14789321560587845, 1.1706953475510837, -0.09424777960769556],
        [0.2934540668545283, 1.1429281301317848, -0.21991148575128394],
        [0.4343869721679189, 1.097136253348137, -0.34557519189487673],
        [0.5684693354400231, 1.0340418824517594, -0.4712388980384681],
        [0.6935865977051177, 0.9546400533624383, -0.5969026041820593],
        [0.8077655849958522, 0.8601829803572659, -0.7225663103256533],
        [0.909205626475431, 0.7521603079034541, -0.8482300164692425],
        [0.9963069520923776, 0.6322756180752162, -0.9738937226128348],
        [1.0676959219099025, 0.5024195640467867, -1.0995574287564285],
        [1.1222466892282807, 0.3646400533624387, -1.2252211349000197],
        [1.1590989558598526, 0.22110995121115565, -1.3508848410436096],
        [1.1776715395453603, 0.07409281304459019, -1.476548547187204],
        [1.18, 8.312880517970662e-16, -1.5393804002589975],
    ]
    @test fp.right == Array{Float64}[
        [-7.590338906473724e-16, 1.154, 0.0],
        [0.14544639945959703, 1.1448107364714037, -0.09424777960769556],
        [0.14544639945959703, 1.1448107364714037, -0.09424777960769556],
        [0.4255797862415413, 1.0726733533553272, -0.34557519189487673],
        [0.4255797862415413, 1.0726733533553272, -0.34557519189487673],
        [0.6789724298809623, 0.9331359584312997, -0.5969026041820593],
        [0.6789724298809623, 0.9331359584312997, -0.5969026041820593],
        [0.8897027386650391, 0.7349661994050392, -0.8482300164692425],
        [0.8897027386650391, 0.7349661994050392, -0.8482300164692425],
        [1.0445297522810049, 0.49061581105355845, -1.0995574287564285],
        [1.0445297522810049, 0.49061581105355845, -1.0995574287564285],
        [1.1337251200494451, 0.21543822693484552, -1.3508848410436096],
        [1.1337251200494451, 0.21543822693484552, -1.3508848410436096],
        [1.154012829430491, -0.0008166797360305358, -1.5393804002589975],
    ]
    @test fp.left == Array{Float64}[
        [-7.590338906473724e-16, 1.206, 0.0],
        [-7.590338906473724e-16, 1.206, 0.0],
        [0.29912579113083837, 1.1683019659421923, -0.21991148575128394],
        [0.29912579113083837, 1.1683019659421923, -0.21991148575128394],
        [0.5802730884332513, 1.057208052080657, -0.4712388980384681],
        [0.5802730884332513, 1.057208052080657, -0.4712388980384681],
        [0.8249596934942671, 0.8796858681676578, -0.7225663103256533],
        [0.8249596934942671, 0.8796858681676578, -0.7225663103256533],
        [1.0178110470235162, 0.6468897858993715, -0.9738937226128348],
        [1.0178110470235162, 0.6468897858993715, -0.9738937226128348],
        [1.1467095892210906, 0.3734472392888163, -1.2252211349000197],
        [1.1467095892210906, 0.3734472392888163, -1.2252211349000197],
        [1.2035561506250403, 0.07653962919087152, -1.476548547187204],
        [1.2035561506250403, 0.07653962919087152, -1.476548547187204],
    ]
end

@testset "Foot Planner Sinusoidale Path" begin
    t = collect(100:(-1):0)
    br.yPath = 1.18 * cos.(4 * pi / 100 .* t)
    br.xPath = 0.01 .* (100 .- t)
    br.initial_position = [br.xPath[1], br.yPath[1], 0]
    fp = ZMProbot.FootPlanner(; br = br, check = false)

    @test fp.center[end][1:2] ≈ [br.xPath[end]; br.yPath[end]] atol = 0.01
    @test length(fp.center) > 0

    @test fp.center == Array{Float64}[
        [0.0, 1.18, 0.0],
        [0.0, 1.18, -0.20943951023931953],
        [0.0, 1.18, -0.41887902047863906],
        [0.0, 1.18, -0.6283185307179586],
        [0.01, 1.1706953475510837, -0.7493940411779365],
        [0.01, 1.1706953475510837, -0.958833551417256],
        [0.01, 1.1706953475510837, -1.1682730616565755],
        [0.03, 1.0971362533481366, -1.3557923842080861],
        [0.05, 0.9546400533624388, -1.4455142442545037],
        [0.07, 0.7521603079034547, -1.4784862607946971],
        [0.08, 0.6322756180752159, -1.4875754946884585],
        [0.09, 0.5024195640467863, -1.4939396681155432],
        [0.1, 0.36464005336243943, -1.4983436387976319],
        [0.11, 0.22110995121115537, -1.5012369362366675],
        [0.12, 0.07409281304459094, -1.5028816556237272],
        [0.13, -0.07409281304458985, -1.5034155572347894],
        [0.14, -0.2211099512111543, -1.5028816556237272],
        [0.15, -0.3646400533624364, -1.5012369362366667],
        [0.16, -0.5024195640467853, -1.498343638797633],
        [0.17, -0.6322756180752149, -1.493939668115543],
        [0.18, -0.7521603079034539, -1.487575494688459],
        [0.19, -0.8601829803572649, -1.4784862607946971],
        [0.21, -1.0340418824517588, -1.445514244254504],
        [0.23, -1.1429281301317846, -1.355792384208086],
        [0.24, -1.1706953475510837, -1.22511954550281],
        [0.24, -1.1706953475510837, -1.0156800352634905],
        [0.24, -1.1706953475510837, -0.806240525024171],
        [0.25, -1.18, -0.7493940411779361],
        [0.25, -1.18, -0.5399545309386166],
        [0.25, -1.18, -0.33051502069929706],
        [0.25, -1.18, -0.12107551045997753],
        [0.25, -1.18, 0.088363999779342],
        [0.25, -1.18, 0.29780351001866157],
        [0.25, -1.18, 0.5072430202579811],
        [0.25, -1.18, 0.7166825304973006],
        [0.26, -1.1706953475510837, 0.7493940411779361],
        [0.26, -1.1706953475510837, 0.9588335514172556],
        [0.26, -1.1706953475510837, 1.168273061656575],
        [0.28, -1.0971362533481366, 1.355792384208086],
        [0.3, -0.9546400533624377, 1.4455142442545053],
        [0.32, -0.7521603079034548, 1.4784862607946971],
        [0.33, -0.632275618075216, 1.4875754946884585],
        [0.34, -0.5024195640467864, 1.493939668115543],
        [0.35000000000000003, -0.3646400533624376, 1.498343638797633],
        [0.36, -0.2211099512111555, 1.5012369362366669],
        [0.37, -0.07409281304459003, 1.5028816556237277],
        [0.38, 0.07409281304458971, 1.503415557234789],
        [0.39, 0.22110995121115418, 1.5028816556237272],
        [0.4, 0.36464005336243727, 1.5012369362366669],
        [0.41000000000000003, 0.5024195640467852, 1.4983436387976323],
        [0.42, 0.6322756180752157, 1.493939668115544],
        [0.43, 0.7521603079034538, 1.487575494688458],
        [0.44, 0.8601829803572649, 1.4784862607946971],
        [0.46, 1.0340418824517588, 1.4455142442545046],
        [0.48, 1.1429281301317846, 1.355792384208085],
        [0.49, 1.1706953475510837, 1.2251195455028092],
        [0.49, 1.1706953475510837, 1.0156800352634896],
        [0.49, 1.1706953475510837, 0.8062405250241701],
        [0.5, 1.18, 0.7493940411779361],
        [0.5, 1.18, 0.5399545309386166],
        [0.5, 1.18, 0.33051502069929706],
        [0.5, 1.18, 0.12107551045997753],
        [0.5, 1.18, -0.088363999779342],
        [0.5, 1.18, -0.29780351001866157],
        [0.5, 1.18, -0.5072430202579811],
        [0.5, 1.18, -0.7166825304973006],
        [0.51, 1.1706953475510837, -0.7493940411779361],
        [0.51, 1.1706953475510837, -0.9588335514172556],
        [0.51, 1.1706953475510837, -1.168273061656575],
        [0.53, 1.0971362533481366, -1.3557923842080848],
        [0.55, 0.9546400533624383, -1.445514244254504],
        [0.5700000000000001, 0.7521603079034541, -1.4784862607946978],
        [0.58, 0.6322756180752162, -1.487575494688459],
        [0.59, 0.5024195640467857, -1.4939396681155435],
        [0.6, 0.3646400533624377, -1.4983436387976323],
        [0.61, 0.22110995121115565, -1.5012369362366664],
        [0.62, 0.07409281304459019, -1.5028816556237277],
        [0.63, -0.07409281304458958, -1.503415557234789],
        [0.64, -0.22110995121115504, -1.5028816556237277],
        [0.65, -0.3646400533624381, -1.5012369362366669],
        [0.66, -0.5024195640467851, -1.4983436387976319],
        [0.67, -0.6322756180752156, -1.4939396681155435],
        [0.68, -0.7521603079034536, -1.4875754946884578],
        [0.6900000000000001, -0.8601829803572656, -1.478486260794698],
        [0.71, -1.034041882451759, -1.4455142442545061],
        [0.73, -1.1429281301317846, -1.3557923842080848],
        [0.74, -1.1706953475510837, -1.2251195455028092],
        [0.74, -1.1706953475510837, -1.0156800352634896],
        [0.74, -1.1706953475510837, -0.8062405250241701],
        [0.75, -1.18, -0.7493940411779361],
        [0.75, -1.18, -0.5399545309386166],
        [0.75, -1.18, -0.33051502069929706],
        [0.75, -1.18, -0.12107551045997753],
        [0.75, -1.18, 0.088363999779342],
        [0.75, -1.18, 0.29780351001866157],
        [0.75, -1.18, 0.5072430202579811],
        [0.75, -1.18, 0.7166825304973006],
        [0.76, -1.1706953475510837, 0.7493940411779361],
        [0.76, -1.1706953475510837, 0.9588335514172556],
        [0.76, -1.1706953475510837, 1.168273061656575],
        [0.78, -1.0971362533481366, 1.3557923842080837],
        [0.8, -0.9546400533624378, 1.4455142442545044],
        [0.8200000000000001, -0.7521603079034539, 1.4784862607946978],
        [0.8300000000000001, -0.6322756180752163, 1.4875754946884576],
        [0.84, -0.5024195640467858, 1.4939396681155444],
        [0.85, -0.3646400533624381, 1.4983436387976323],
        [0.86, -0.2211099512111553, 1.5012369362366669],
        [0.87, -0.07409281304458981, 1.5028816556237277],
        [0.88, 0.0740928130445897, 1.503415557234789],
        [0.89, 0.22110995121115493, 1.5028816556237274],
        [0.9, 0.364640053362438, 1.5012369362366669],
        [0.91, 0.5024195640467857, 1.4983436387976323],
        [0.92, 0.6322756180752159, 1.4939396681155435],
        [0.93, 0.7521603079034538, 1.4875754946884578],
        [0.9400000000000001, 0.8601829803572656, 1.4784862607946978],
        [0.96, 1.034041882451759, 1.4455142442545057],
        [0.98, 1.1429281301317846, 1.3557923842080837],
        [0.99, 1.1706953475510837, 1.2251195455028092],
        [0.99, 1.1706953475510837, 1.0156800352634896],
        [0.99, 1.1706953475510837, 0.8062405250241701],
        [1.0, 1.18, 0.7493940411779361],
    ]
    @test fp.right == Array{Float64}[
        [0.0, 1.154, 0.0],
        [-0.005405703961261742, 1.154568162380921, -0.20943951023931953],
        [-0.005405703961261742, 1.154568162380921, -0.20943951023931953],
        [-0.0152824165596043, 1.1589655581462512, -0.6283185307179586],
        [-0.0152824165596043, 1.1589655581462512, -0.6283185307179586],
        [-0.01128157276910263, 1.1557589938972166, -0.958833551417256],
        [-0.01128157276910263, 1.1557589938972166, -0.958833551417256],
        [0.004598635620478676, 1.091589120065189, -1.3557923842080861],
        [0.004598635620478676, 1.091589120065189, -1.3557923842080861],
        [0.044110696289245015, 0.7497636532824699, -1.4784862607946971],
        [0.044110696289245015, 0.7497636532824699, -1.4784862607946971],
        [0.06407675250554709, 0.5004232576220756, -1.4939396681155432],
        [0.06407675250554709, 0.5004232576220756, -1.4939396681155432],
        [0.08406287525658478, 0.21930286514665326, -1.5012369362366675],
        [0.08406287525658478, 0.21930286514665326, -1.5012369362366675],
        [0.10405899985787695, -0.07584338770063047, -1.5034155572347894],
        [0.10405899985787695, -0.07584338770063047, -1.5034155572347894],
        [0.12406287525658477, -0.3664471394269385, -1.5012369362366667],
        [0.12406287525658477, -0.3664471394269385, -1.5012369362366667],
        [0.1440767525055471, -0.6342719244999256, -1.493939668115543],
        [0.1440767525055471, -0.6342719244999256, -1.493939668115543],
        [0.16411069628924502, -0.8625796349782497, -1.4784862607946971],
        [0.16411069628924502, -0.8625796349782497, -1.4784862607946971],
        [0.2045986356204787, -1.1484752634147322, -1.355792384208086],
        [0.2045986356204787, -1.1484752634147322, -1.355792384208086],
        [0.21790418195752737, -1.18439844300554, -1.0156800352634905],
        [0.21790418195752737, -1.18439844300554, -1.0156800352634905],
        [0.23228892319888791, -1.1990346462679269, -0.7493940411779361],
        [0.23228892319888791, -1.1990346462679269, -0.7493940411779361],
        [0.24156221436353675, -1.2045927585592404, -0.33051502069929706],
        [0.24156221436353675, -1.2045927585592404, -0.33051502069929706],
        [0.25229447531960614, -1.2058985594774636, 0.088363999779342],
        [0.25229447531960614, -1.2058985594774636, 0.088363999779342],
        [0.2626300006482617, -1.2027262641810066, 0.5072430202579811],
        [0.2626300006482617, -1.2027262641810066, 0.5072430202579811],
        [0.2777110768011121, -1.1897299938190107, 0.7493940411779361],
        [0.2777110768011121, -1.1897299938190107, 0.7493940411779361],
        [0.28392196188676716, -1.1808806182636402, 1.168273061656575],
        [0.28392196188676716, -1.1808806182636402, 1.168273061656575],
        [0.3257962239389249, -0.9578888732239935, 1.4455142442545053],
        [0.3257962239389249, -0.9578888732239935, 1.4455142442545053],
        [0.35591001776088527, -0.6344368630013202, 1.4875754946884585],
        [0.35591001776088527, -0.6344368630013202, 1.4875754946884585],
        [0.37593178775126196, -0.36652217557512795, 1.498343638797633],
        [0.37593178775126196, -0.36652217557512795, 1.498343638797633],
        [0.3959400618102853, -0.07585723739223964, 1.5028816556237277],
        [0.3959400618102853, -0.07585723739223964, 1.5028816556237277],
        [0.4159400618102853, 0.21934552686350456, 1.5028816556237272],
        [0.4159400618102853, 0.21934552686350456, 1.5028816556237272],
        [0.43593178775126196, 0.5005374418340949, 1.4983436387976323],
        [0.43593178775126196, 0.5005374418340949, 1.4983436387976323],
        [0.45591001776088524, 0.7499990629773496, 1.487575494688458],
        [0.45591001776088524, 0.7499990629773496, 1.487575494688458],
        [0.4857962239389249, 1.0307930625902029, 1.4455142442545046],
        [0.4857962239389249, 1.0307930625902029, 1.4455142442545046],
        [0.5144620051498685, 1.161885676498893, 1.2251195455028092],
        [0.5144620051498685, 1.161885676498893, 1.2251195455028092],
        [0.5087639376591222, 1.152697718720469, 0.8062405250241701],
        [0.5087639376591222, 1.152697718720469, 0.8062405250241701],
        [0.5133665217897373, 1.157698966498288, 0.5399545309386166],
        [0.5133665217897373, 1.157698966498288, 0.5399545309386166],
        [0.5031402777618881, 1.1541903379414182, 0.12107551045997753],
        [0.5031402777618881, 1.1541903379414182, 0.12107551045997753],
        [0.4923710511804806, 1.155144434427896, -0.29780351001866157],
        [0.4923710511804806, 1.155144434427896, -0.29780351001866157],
        [0.4829209391567922, 1.160396284007515, -0.7166825304973006],
        [0.4829209391567922, 1.160396284007515, -0.7166825304973006],
        [0.48871842723089737, 1.1557589938972166, -0.9588335514172556],
        [0.48871842723089737, 1.1557589938972166, -0.9588335514172556],
        [0.5045986356204787, 1.0915891200651888, -1.3557923842080848],
        [0.5045986356204787, 1.0915891200651888, -1.3557923842080848],
        [0.544110696289245, 0.7497636532824694, -1.4784862607946978],
        [0.544110696289245, 0.7497636532824694, -1.4784862607946978],
        [0.564076752505547, 0.5004232576220751, -1.4939396681155435],
        [0.564076752505547, 0.5004232576220751, -1.4939396681155435],
        [0.5840628752565847, 0.21930286514665348, -1.5012369362366664],
        [0.5840628752565847, 0.21930286514665348, -1.5012369362366664],
        [0.6040589998578769, -0.0758433877006302, -1.503415557234789],
        [0.6040589998578769, -0.0758433877006302, -1.503415557234789],
        [0.6240628752565848, -0.36644713942694024, -1.5012369362366669],
        [0.6240628752565848, -0.36644713942694024, -1.5012369362366669],
        [0.6440767525055471, -0.6342719244999262, -1.4939396681155435],
        [0.6440767525055471, -0.6342719244999262, -1.4939396681155435],
        [0.664110696289245, -0.8625796349782503, -1.478486260794698],
        [0.664110696289245, -0.8625796349782503, -1.478486260794698],
        [0.7045986356204786, -1.1484752634147324, -1.3557923842080848],
        [0.7045986356204786, -1.1484752634147324, -1.3557923842080848],
        [0.7179041819575274, -1.18439844300554, -1.0156800352634896],
        [0.7179041819575274, -1.18439844300554, -1.0156800352634896],
        [0.7322889231988879, -1.1990346462679269, -0.7493940411779361],
        [0.7322889231988879, -1.1990346462679269, -0.7493940411779361],
        [0.7415622143635368, -1.2045927585592404, -0.33051502069929706],
        [0.7415622143635368, -1.2045927585592404, -0.33051502069929706],
        [0.7522944753196061, -1.2058985594774636, 0.088363999779342],
        [0.7522944753196061, -1.2058985594774636, 0.088363999779342],
        [0.7626300006482617, -1.2027262641810066, 0.5072430202579811],
        [0.7626300006482617, -1.2027262641810066, 0.5072430202579811],
        [0.7777110768011121, -1.1897299938190107, 0.7493940411779361],
        [0.7777110768011121, -1.1897299938190107, 0.7493940411779361],
        [0.7839219618867672, -1.1808806182636402, 1.168273061656575],
        [0.7839219618867672, -1.1808806182636402, 1.168273061656575],
        [0.8257962239389249, -0.9578888732239937, 1.4455142442545044],
        [0.8257962239389249, -0.9578888732239937, 1.4455142442545044],
        [0.8559100177608853, -0.6344368630013204, 1.4875754946884576],
        [0.8559100177608853, -0.6344368630013204, 1.4875754946884576],
        [0.8759317877512619, -0.36652217557512845, 1.4983436387976323],
        [0.8759317877512619, -0.36652217557512845, 1.4983436387976323],
        [0.8959400618102853, -0.07585723739223942, 1.5028816556237277],
        [0.8959400618102853, -0.07585723739223942, 1.5028816556237277],
        [0.9159400618102853, 0.21934552686350534, 1.5028816556237274],
        [0.9159400618102853, 0.21934552686350534, 1.5028816556237274],
        [0.935931787751262, 0.5005374418340953, 1.4983436387976323],
        [0.935931787751262, 0.5005374418340953, 1.4983436387976323],
        [0.9559100177608852, 0.7499990629773496, 1.4875754946884578],
        [0.9559100177608852, 0.7499990629773496, 1.4875754946884578],
        [0.9857962239389249, 1.030793062590203, 1.4455142442545057],
        [0.9857962239389249, 1.030793062590203, 1.4455142442545057],
        [1.0144620051498685, 1.161885676498893, 1.2251195455028092],
        [1.0144620051498685, 1.161885676498893, 1.2251195455028092],
        [1.0087639376591222, 1.152697718720469, 0.8062405250241701],
        [1.0087639376591222, 1.152697718720469, 0.8062405250241701],
    ]
    @test fp.left == Array{Float64}[
        [0.0, 1.206, 0.0],
        [0.0, 1.206, 0.0],
        [0.010575152719970804, 1.2037521818987076, -0.41887902047863906],
        [0.010575152719970804, 1.2037521818987076, -0.41887902047863906],
        [0.0277110768011121, 1.1897299938190107, -0.7493940411779365],
        [0.0277110768011121, 1.1897299938190107, -0.7493940411779365],
        [0.03392196188676716, 1.1808806182636402, -1.1682730616565755],
        [0.03392196188676716, 1.1808806182636402, -1.1682730616565755],
        [0.07579622393892486, 0.9578888732239947, -1.4455142442545037],
        [0.07579622393892486, 0.9578888732239947, -1.4455142442545037],
        [0.10591001776088525, 0.6344368630013201, -1.4875754946884585],
        [0.10591001776088525, 0.6344368630013201, -1.4875754946884585],
        [0.12593178775126193, 0.3665221755751298, -1.4983436387976319],
        [0.12593178775126193, 0.3665221755751298, -1.4983436387976319],
        [0.1459400618102853, 0.07585723739224054, -1.5028816556237272],
        [0.1459400618102853, 0.07585723739224054, -1.5028816556237272],
        [0.1659400618102853, -0.21934552686350467, -1.5028816556237272],
        [0.1659400618102853, -0.21934552686350467, -1.5028816556237272],
        [0.18593178775126193, -0.500537441834095, -1.498343638797633],
        [0.18593178775126193, -0.500537441834095, -1.498343638797633],
        [0.20591001776088524, -0.7499990629773498, -1.487575494688459],
        [0.20591001776088524, -0.7499990629773498, -1.487575494688459],
        [0.23579622393892485, -1.0307930625902029, -1.445514244254504],
        [0.23579622393892485, -1.0307930625902029, -1.445514244254504],
        [0.2644620051498685, -1.161885676498893, -1.22511954550281],
        [0.2644620051498685, -1.161885676498893, -1.22511954550281],
        [0.2587639376591222, -1.152697718720469, -0.806240525024171],
        [0.2587639376591222, -1.152697718720469, -0.806240525024171],
        [0.2633665217897373, -1.157698966498288, -0.5399545309386166],
        [0.2633665217897373, -1.157698966498288, -0.5399545309386166],
        [0.2531402777618881, -1.1541903379414182, -0.12107551045997753],
        [0.2531402777618881, -1.1541903379414182, -0.12107551045997753],
        [0.24237105118048058, -1.155144434427896, 0.29780351001866157],
        [0.24237105118048058, -1.155144434427896, 0.29780351001866157],
        [0.2329209391567922, -1.160396284007515, 0.7166825304973006],
        [0.2329209391567922, -1.160396284007515, 0.7166825304973006],
        [0.2387184272308974, -1.1557589938972166, 0.9588335514172556],
        [0.2387184272308974, -1.1557589938972166, 0.9588335514172556],
        [0.2545986356204787, -1.091589120065189, 1.355792384208086],
        [0.2545986356204787, -1.091589120065189, 1.355792384208086],
        [0.294110696289245, -0.74976365328247, 1.4784862607946971],
        [0.294110696289245, -0.74976365328247, 1.4784862607946971],
        [0.3140767525055471, -0.5004232576220757, 1.493939668115543],
        [0.3140767525055471, -0.5004232576220757, 1.493939668115543],
        [0.3340628752565848, -0.21930286514665337, 1.5012369362366669],
        [0.3340628752565848, -0.21930286514665337, 1.5012369362366669],
        [0.354058999857877, 0.07584338770063034, 1.503415557234789],
        [0.354058999857877, 0.07584338770063034, 1.503415557234789],
        [0.3740628752565848, 0.3664471394269394, 1.5012369362366669],
        [0.3740628752565848, 0.3664471394269394, 1.5012369362366669],
        [0.3940767525055471, 0.6342719244999263, 1.493939668115544],
        [0.3940767525055471, 0.6342719244999263, 1.493939668115544],
        [0.414110696289245, 0.8625796349782497, 1.4784862607946971],
        [0.414110696289245, 0.8625796349782497, 1.4784862607946971],
        [0.45459863562047864, 1.1484752634147324, 1.355792384208085],
        [0.45459863562047864, 1.1484752634147324, 1.355792384208085],
        [0.46790418195752737, 1.18439844300554, 1.0156800352634896],
        [0.46790418195752737, 1.18439844300554, 1.0156800352634896],
        [0.4822889231988879, 1.1990346462679269, 0.7493940411779361],
        [0.4822889231988879, 1.1990346462679269, 0.7493940411779361],
        [0.49156221436353675, 1.2045927585592404, 0.33051502069929706],
        [0.49156221436353675, 1.2045927585592404, 0.33051502069929706],
        [0.5022944753196061, 1.2058985594774636, -0.088363999779342],
        [0.5022944753196061, 1.2058985594774636, -0.088363999779342],
        [0.5126300006482617, 1.2027262641810066, -0.5072430202579811],
        [0.5126300006482617, 1.2027262641810066, -0.5072430202579811],
        [0.5277110768011121, 1.1897299938190107, -0.7493940411779361],
        [0.5277110768011121, 1.1897299938190107, -0.7493940411779361],
        [0.5339219618867672, 1.1808806182636402, -1.168273061656575],
        [0.5339219618867672, 1.1808806182636402, -1.168273061656575],
        [0.5757962239389249, 0.9578888732239942, -1.445514244254504],
        [0.5757962239389249, 0.9578888732239942, -1.445514244254504],
        [0.6059100177608852, 0.6344368630013203, -1.487575494688459],
        [0.6059100177608852, 0.6344368630013203, -1.487575494688459],
        [0.6259317877512619, 0.36652217557512806, -1.4983436387976323],
        [0.6259317877512619, 0.36652217557512806, -1.4983436387976323],
        [0.6459400618102853, 0.07585723739223979, -1.5028816556237277],
        [0.6459400618102853, 0.07585723739223979, -1.5028816556237277],
        [0.6659400618102853, -0.21934552686350545, -1.5028816556237277],
        [0.6659400618102853, -0.21934552686350545, -1.5028816556237277],
        [0.685931787751262, -0.5005374418340948, -1.4983436387976319],
        [0.685931787751262, -0.5005374418340948, -1.4983436387976319],
        [0.7059100177608852, -0.7499990629773494, -1.4875754946884578],
        [0.7059100177608852, -0.7499990629773494, -1.4875754946884578],
        [0.7357962239389249, -1.030793062590203, -1.4455142442545061],
        [0.7357962239389249, -1.030793062590203, -1.4455142442545061],
        [0.7644620051498685, -1.161885676498893, -1.2251195455028092],
        [0.7644620051498685, -1.161885676498893, -1.2251195455028092],
        [0.7587639376591222, -1.152697718720469, -0.8062405250241701],
        [0.7587639376591222, -1.152697718720469, -0.8062405250241701],
        [0.7633665217897373, -1.157698966498288, -0.5399545309386166],
        [0.7633665217897373, -1.157698966498288, -0.5399545309386166],
        [0.7531402777618881, -1.1541903379414182, -0.12107551045997753],
        [0.7531402777618881, -1.1541903379414182, -0.12107551045997753],
        [0.7423710511804805, -1.155144434427896, 0.29780351001866157],
        [0.7423710511804805, -1.155144434427896, 0.29780351001866157],
        [0.7329209391567922, -1.160396284007515, 0.7166825304973006],
        [0.7329209391567922, -1.160396284007515, 0.7166825304973006],
        [0.7387184272308974, -1.1557589938972166, 0.9588335514172556],
        [0.7387184272308974, -1.1557589938972166, 0.9588335514172556],
        [0.7545986356204787, -1.0915891200651888, 1.3557923842080837],
        [0.7545986356204787, -1.0915891200651888, 1.3557923842080837],
        [0.794110696289245, -0.7497636532824692, 1.4784862607946978],
        [0.794110696289245, -0.7497636532824692, 1.4784862607946978],
        [0.814076752505547, -0.5004232576220752, 1.4939396681155444],
        [0.814076752505547, -0.5004232576220752, 1.4939396681155444],
        [0.8340628752565847, -0.21930286514665315, 1.5012369362366669],
        [0.8340628752565847, -0.21930286514665315, 1.5012369362366669],
        [0.8540589998578769, 0.07584338770063033, 1.503415557234789],
        [0.8540589998578769, 0.07584338770063033, 1.503415557234789],
        [0.8740628752565848, 0.3664471394269401, 1.5012369362366669],
        [0.8740628752565848, 0.3664471394269401, 1.5012369362366669],
        [0.8940767525055471, 0.6342719244999265, 1.4939396681155435],
        [0.8940767525055471, 0.6342719244999265, 1.4939396681155435],
        [0.914110696289245, 0.8625796349782503, 1.4784862607946978],
        [0.914110696289245, 0.8625796349782503, 1.4784862607946978],
        [0.9545986356204786, 1.1484752634147324, 1.3557923842080837],
        [0.9545986356204786, 1.1484752634147324, 1.3557923842080837],
        [0.9679041819575274, 1.18439844300554, 1.0156800352634896],
        [0.9679041819575274, 1.18439844300554, 1.0156800352634896],
        [0.9822889231988879, 1.1990346462679269, 0.7493940411779361],
    ]
end

sleep(0.1) # used for good printing
println("End test")

end # End Main Module 

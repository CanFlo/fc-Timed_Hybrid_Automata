module Test_PC

include(joinpath(@__DIR__, "..", "..", "src", "ZMPBipedRobot.jl"))
import .ZMPBipedRobot
const ZMProbot = ZMPBipedRobot
using Test

sleep(0.1) # used for good printing
println("Started test")

@testset "Preview Control" begin
    URDFfileName = "ZMP_2DBipedRobot.urdf"

    br = ZMProbot.BipedRobot(;
        readFile = true,
        URDFfileName = URDFfileName,
        paramFileName = "param_test.jl",
    )

    pc = ZMProbot.PreviewController(; br = br)
    @test length(pc.Gx) == 3
    @test length(pc.Gi) == 1
    @test length(pc.Gd) == (br.previewTime / br.Ts + 1)

    @test isapprox(
        pc.Gx,
        [9140.764475990629 1585.946832999117 49.622729472541884];
        atol = 1e-6,
    )
    @test isapprox(pc.Gi, [559.0591124209329]; atol = 1e-6)
    @test isapprox(
        pc.Gd,
        [
            -559.0591124209329; -681.2743535925572; -788.37381338848; -831.7356606467497; -811.3057184216618; -746.6989633124515; -660.2788092643514; -569.4890818736301; -484.9650264229359; -411.5176555137078; -350.0572076675278; -299.4147924631716; -257.656006332882; -222.84686976743234; -193.39476607984233; -168.12341471634952; -146.21570658790495; -127.11382324961504; -110.42492239743001; -95.85131014613192; -83.14699175914916; -72.09490538050284; -62.497405355536266; -54.173698475283686; -46.95998340285493; -40.70995324102954; -35.29469269351932; -30.60180381870912; -26.533958957475765; -23.007171121793604; -19.949028461041564; -17.29705163479553; -14.997249969892511; -13.00289316468876; -11.27348177896352; -9.773885970282155; -8.47362039678112; -7.346227611432039; -6.368748441706915; -5.521263542399779; -4.786494671015163; -4.149457204943453; -3.5971572899073787; -3.1183281491581143; -2.7032008044633895; -2.343304975603109; -2.0312963553759085; -1.760806856411585; -1.5263148098091175; -1.3230324610972215; -1.1468084484393337;;
        ];
        atol = 1e-6,
    )
end

sleep(0.1) # used for good printing
println("End test")

end # End Main Module 
